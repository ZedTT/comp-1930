<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ToyShare: Canada's No.1 Toy Donation/Sell Center</title>

    <!-- Links for JQuery-->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css" type="text/css"
        media="all" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script> -->
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans" rel="stylesheet">
    <link rel="icon" href="toyShareLogopng.png">

    <link rel="stylesheet" href="css/asRange.css">
    <script src="JQuery.js"></script>
    <script src="jquery-asRange.js"></script>

    <script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = { //hello
            apiKey: "AIzaSyBwSxJojnYNo9ZFKHmO59sKVPdEhCR641A",
            authDomain: "comp1930database.firebaseapp.com",
            databaseURL: "https://comp1930database.firebaseio.com",
            projectId: "comp1930database",
            storageBucket: "comp1930database.appspot.com",
            messagingSenderId: "908131063499"
        };
        firebase.initializeApp(config);
    </script>
    <link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet">
    <style>
        /*
         * #fbf5f3
         * #93e1d8
         * #e28413
         * #db3a34
         * #000022 
         */

        .color-white-0 {
            color: #FBF5F3
        }

        .color-white-1 {
            color: #9C8881
        }

        .color-white-2 {
            color: #C0B3AE
        }

        .color-white-3 {
            color: #FFFAF8
        }

        .color-blue-0 {
            color: #93E1D9
        }

        .color-blue-1 {
            color: #F3FEFD
        }

        .color-blue-2 {
            color: #C4F4EF
        }

        .color-blue-3 {
            color: #66C6BC
        }

        .color-blue-4 {
            color: #3EA197
        }

        .color-orange-0 {
            color: #E28413
        }

        .color-orange-1 {
            color: #FFBC6D
        }

        .color-orange-2 {
            color: #F1A142
        }

        .color-orange-3 {
            color: #B36407
        }

        .color-orange-4 {
            color: #8C4C00
        }

        .color-red-0 {
            color: #DB3834
        }

        .color-red-1 {
            color: #FF8B88
        }

        .color-red-2 {
            color: #F15E5A
        }

        .color-red-3 {
            color: #B71B17
        }

        .color-red-4 {
            color: #900603
        }

        .color-black-0 {
            color: #000022
        }

        #colors {
            color: #fbf5f3;
            /* background */
            color: #93e1d8;
            /* */
            color: #e28413;
            /* */
            color: #db3a34;
            /* */
            color: #000022;
            /* */

            color: #F4EFED;
            /* background white darker */
        }

        /* accounts for padding and border when calculating width */
        html * {
            box-sizing: border-box;
        }

        body {
            /* background-image: url("https://d1q8kgt00fn2v8.cloudfront.net/files/uploads/2018/03/kids_playing_with-_blocks-1600x1067.jpg"); */
            /* background-repeat: no-repeat; */
            /* background-size: cover; */
            margin: 0px;
            padding: 0px;
            background-color: #dae0e6;
            color: #000022;
        }

        .header2 {
            width: 100%;
            background-color: #ffffff;
            display: grid;
            grid-template-rows: 55px;
            grid-template-columns: min-content minmax(auto, 400px) min-content;
            justify-content: space-between;
            grid-template-areas:
                "left middle right";
            position: fixed;
            z-index: 1;
        }

        #left {
            max-width: 250px;
            width: min-content;
            text-decoration: none;
        }

        .header2 p {
            font-family: 'Gloria Hallelujah', cursive;
            font-size: 25pt;
            color: #ff4500;
            /* color: #991c1c; */
            margin-left: 1em;
            margin-right: 1em;
            /*added right margin for when things get close */
            line-height: 55px;
            margin-top: -3px;
            font-weight: bolder;
            vertical-align: middle;
        }

        #content {
            display: grid;
            transform: translate(0px, 55px);
            padding-top: 40px;
            justify-content: space-evenly;
            justify-items: center;
            grid-template-columns: 11% 13% 42% 22% 11%;
            grid-template-areas:
                "emptyLeft sideBar listings ads emptyRight";
        }

        /* Causes filters to go above content on small screens */
        /* @media (max-width: 770px) {
            #content {
                grid-template-areas: 
                "sideBar"
                "listings";
                grid-template-columns: 90%;
            }
            #filtersContainer {
                width: 100%;
            }
        } */

        /* causes ads to disapear on small screens */
        @media only screen and (max-width: 1000px) {
            #content {
                grid-template-columns: 0% 25% 60%;
            }

            #ads {
                display: none;
            }

            #emptyLeft {
                display: none;
            }

            #emptyRight {
                display: none;
            }
        }

        /* causes profile Image to disapear on small screens */
        @media only screen and (max-width: 1000px) {
            #right {
                margin-left: -30px;
            }
        }

        /**#searchContainer {
            grid-area: searchBar;
            width: 100%;
            text-align: center;
            background-color: crimson;
        }*/

        .searchBar {
            grid-area: middle;
            width: 100%;
            /* Width will fill the grid area if less than max width */
            max-width: 400px;
            /* The 400 needs to be max-width or we get horizontal scrolling */
            /* not neccessary at all because grid-template-columns of parent limits this to 400px now, anyways */
            height: 13px;
            background-color: #f7f7f7;
            border: 1px solid #cfcfcf;
            border-radius: 3px;
            margin: auto auto auto auto;
            text-align: center;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            font-weight: 100;
            color: black;
            font-size: 10pt;
            padding: 18px;
            text-align: left;
        }

        .searchBar:hover {
            border: 1px solid #0079d3;
        }

        #right {
            max-width: 250px;
            width: min-content;
            grid-area: right;
            height: 100%;
            display: grid;
            /* vertical align */
            grid-template-columns: repeat(2, auto);
            justify-self: center;
            /* could be end */
        }

        .favouritesButton {
            /* grid-area: right; */
            /* added to parent */
            width: 70px;
            height: 30px;
            border-radius: 3px;
            background-color: rgb(0, 121, 211);
            /* blue 0 */
            border: 1px solid rgb(0, 121, 211);
            /* blue 4 */
            color: #FBF5F3;
            /* white 0 */
            text-align: center;
            /* vertical-align: middle; */
            /* no longer needed */
            line-height: 30px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-weight: bold;
            margin: auto 1em;
            /* added minimum left and right margin */
            font-size: 10pt;
            margin-left: 60px;
            margin-top: 11px;
            padding: 0px 65px 30px 35px;
        }

        .favouritesButton:hover {
            background-color: rgb(51, 148, 220);
            cursor: pointer;

        }
        #filtersContainer {
            grid-area: sideBar;
            /* position: fixed; */
            transition: 0.25s;
        }

        #filters {
            /* width: 20vw; */
            border-radius: 3px;
            font-size: 10pt;
            background-color: #ffffff;
            padding: 10px;
            font-family: arial;
            border: 1px solid #dad9d9;
            width: 85%;
            margin: 0 auto;
        }

        #filters span {
            text-align: center;
            font-size: 8pt;
        }

        #filters h3 {
            margin: 0;
        }

        .filter {
            margin: 1.5rem 0rem;
        }

        .sliderTitle {
            margin-bottom: 3rem;
        }

        .asRange {
            width: 80%;
            margin: 0 auto;
        }

        .asRange .asRange-selected {
            background-color: #0079d3;
            /* blue 0 */
        }

        .asRange .asRange-pointer .asRange-tip {
            color: #FBF5F3;
            background-color: #0079d3;
            border: 1px solid #0079d3;
        }

        .asRange .asRange-pointer .asRange-tip:before {
            background-color: #0079d3;
            /* orange 0 #DB3834*/
        }

        .asRange .asRange-pointer {
            background-color: #ffffff;
        }

        .asRange .asRange-pointer:before {
            background: #0079d3;
            /* blue 4 */
        }

        .asRange .asRange-pointer:after {
            background: #F3FEFD;
            /* blue 1 */
        }

        #listingsContainer {
            grid-area: listings;
            /* overflow-y: auto; */
            /* height: calc(100vh - 95px); */
            width: 100%;

            /* display: grid; */
            /* grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); */
            /* grid-template-rows: repeat(auto-fill, 1fr); */
            /* grid-gap: 25px; */
        }

        .toyListing {
            border: 1px solid #dad9d9;
            border-radius: 3px;
            font-size: 10pt;
            /* width: calc(100% - 30px); 100% minus any padding */
            width: 100%;
            /* because of the box-sizing property applied to *, we can ignore padding */
            margin: auto;
            margin-bottom: 1rem;
            background-color: #ffffff;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            padding: 5px;
            /* If padding is changed width must be changed */
            /* we no longer have to worry about padding because of the box-sizing */
            padding-right: 30px;
            padding-left: 10px;

            display: grid;
            grid-template-areas:
                "img ttl ttl"
                "img prc age";
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            /* grid-template-areas:
                "img img"
                "ttl ttl"
                "prc age"; */
            height: 200px;
            align-content: flex-end;
        }

        .toyListing:hover {
            border: 1px solid #acacac;
            /* padding: calc(5px - 0px) calc(30px - 0px) calc(5px - 0px) calc(10px - 0px); */
            cursor: pointer;
        }

        .toyListing img {
            grid-area: img;
            object-fit: contain;
            max-width: 90%;
            height: 90%;
            /* max-height: 100%; */
            margin: 10px;
            align-self: flex-start;
        }

        .toyListing span {
            text-decoration: underline;
        }

        .listingTitle {
            grid-area: ttl;
            background-color: #f1f1f1;
            border: 1px solid #f1f1f1;
            border-radius: 5px;
            padding-left: 8px;
            margin-top: 10px;
            margin-bottom: 18px;
            width: 100%;
            font-weight: 500;
            font-size: 13pt;
            /* height: 25px; */
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .listingPrice span {
            grid-area: prc;
            font-size: 7pt;
        }

        .listingAgeRange span {
            grid-area: age;
            font-size: 7pt;
            text-decoration: none;
        }

        #ads {
            grid-area: ads;
            justify-content: center;
        }

        .wasteInfo {
            border: 1px solid #c4c4c4;
            border-radius: 5px;
            /** background-image: url(https://media.istockphoto.com/illustrations/abstract-yellow-watercolor-texture-background-illustration-id532126526?k=6&m=532126526&s=612x612&w=0&h=n_AGA8IEeqlMTBNoylH0y7R-1oejDXFSlRG0-sXPaeA=); */
            background-color: yellow;
            margin: 0 auto;
            height: 390px;
            width: 90%;
        }

        .wasteInfo p {
            /* text-align: center; */
            font-size: 15pt;
            font-weight: bold;
            text-align: left;
            padding: 10px;
            font-family: Arial, Helvetica, sans-serif;
            margin: 0;
        }

        .wasteInfo img {
            width: 100%;
            height: auto;
        }

        .learnMore {
            /* width: calc(90% - 20px); we no longer have to worry about subtracting padding due to box sizing */
            width: 90%;
            /* height: 125px; */
            padding: 10px;
            text-align: center;
            font-weight: bold;
            background-color: #991c1c;
            border: 5px solid #991c1c;
            border-radius: 5px;
            margin: 20px auto;
            font-size: 15pt;
            color: white;
            font-family: Arial;
        }

        .learnMoreButton {
            width: 120px;
            /* height: 30px; */
            border: 3px solid white;
            border-radius: 50px;
            margin: 0 auto;
            font-size: 13pt;
            vertical-align: middle;
            line-height: 30px;
            margin-top: 20px;
        }

        .learnMoreButton:hover {
            border: 3px solid #acacac;
            color: #acacac;
        }

        .ecoCityAd1 {
            width: 90%;
            height: auto;
            margin: 0 auto;
            background-color: white;
            border: 1px solid white;
            border-radius: 5px;
        }

        .ecoCityAd1 img {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }
        
        img#profileSetting {
            margin-bottom: -2px;
            margin-top: 13.5px;
            margin-left: 4px;
            width: 32.5px;
            height: 28.8px;
            padding: 0;
        }

        .dropShadow {
            filter: drop-shadow(0px 0px 5px #EBDDD0);
            /* carpet color */
        }
        #date_time {
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 10pt;
			position: fixed;
            margin-left: 90vw;
            margin-top: 88.9vh;
        }
        #toyShareLogo {
            width: 55px;
            height: 45px;
            margin-top: 3px;
            margin-left: 14px;

        }
        #toyShareText {
            position: absolute;
            top:0;
            left: 0;
            margin-top: 13px;
            margin-left: 70px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 16pt;
            font-weight: 800;
        }
        .profileButton img:hover {
            cursor: pointer;
            opacity: 0.7;
        }

        .fav-btn {
            width: 100px;
            height: 100px;
            position: absolute;
            /* left: 50%;
            top: 50%;
            transform: translate(-50%, -50%); */
            background:   url(http://www.capgunmedia.co/favorites-button.png) no-repeat;
            background-position: 0 0;
            cursor: pointer;
            animation: favorites 1s steps(28);
        }
        .fav-btn:hover {
            background-position: -2800px 0;
            transition: background 0s steps(1);
        }
        @keyframes favorites {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: -2800px 0;
            }
        }

    </style>
</head>

<body>
    <div class="header2 dropShadow">
        <div id="left">
            <p>Toyshare</p>
            <div class="fav-btn"></div>
            <a href="databaseTest.html">
            <img src="toyShareLogopng.png" alt="toyShareLogo" id="toyShareLogo">
            <h1 id="toyShareText">ToyShare</h1>
        </a>
        </div>
        <input class="searchBar" type="search" placeholder="Search for toys...." />
        <div id="right">
            <div class="favouritesButton">Saved</div>
            <div class="profileButton">
                <img src="https://teambodyproject.com/wp-content/uploads/2019/01/profile-icon.png" alt="profileSetting"
                    id="profileSetting"></div>
                    <div></div>
        </div>
    </div>
    <div id="content">
            <div id="date_time"></div>

        <div id="filtersContainer" class="dropShadow">
            <div id="filters">
                <h3>Filters</h3>
                <!-- <div class="filter">
                    <div class="filterTitle">Name of toy:</div>
                    <input type="text" name="Name" placeholder="Name" pattern="[A-Za-z1-9]" />
                </div> -->
                <div class="filter">
                    <div class="filterTitle sliderTitle">Price:</div>
                    <input class="priceSlider slider" type="range" min="0" max="100" name="price" step="1" />
                </div>
                <div class="filter">
                    <div class="filterTitle sliderTitle">Age:</div>
                    <input class="ageSlider slider" type="range" min="0" max="20" name="age" step="1" />
                </div>
                <div>sliders coutesy of <a
                        href="https://github.com/thecreation/jquery-asRange">github.com/thecreation/</a></div>
            </div>
        </div>
        <div id="listingsContainer" class="dropShadow"></div>
        <div id="ads" class="dropShadow">
            <div class="wasteInfo">
                <img src="http://thearenaweekly.myschoolarena.com/wp-content/uploads/2018/04/doctor.jpg"
                    alt="Kid Playing With Toy">
                <div id="message">
                    <p>Global plastics consumption is predicted to grow dramatically.</p>
                    <p>Please reuse!</p>
                </div>
            </div>
            <div class="learnMore">Learn more on how to donate at your local ToyShare.
                <div class="learnMoreButton" onclick="location.href='https://www.reddit.com/';" style="cursor:pointer;">
                    Learn More</div>
            </div>
            <div class="ecoCityAd1"><a href="http://ecocity2019.com/" target="blank"><img
                        src="http://ecocity2019.com/wp-content/uploads/2018/09/ecocity_web_logo.png"
                        alt="Dead Fish"></a> </div>
        </div>
    </div>

    <script>
        // usage: elm("div", document.body, "myID", "myClass");
        function elm(tag, parent, id, cssClass) {
            var thisElm = document.createElement(tag);
            if (id) {
                thisElm.setAttribute("id", id);
            };
            if (cssClass) {
                thisElm.setAttribute("class", cssClass);
            };
            parent.appendChild(thisElm);
            return thisElm
        };

        // Adds style to an element
        function addStyle(element, property, value) {
            var currentStyle = element.getAttribute("style");
            if (!currentStyle) {
                currentStyle = ""
            }
            element.setAttribute("style", currentStyle + " " + property + ": " + value + ";");
        };

        // Adds style to an element. styleArray must have an even number of indexes.
        function addArrayOfStyles(element, styleArray) {
            var currentStyle = element.getAttribute("style");
            if (!currentStyle) {
                currentStyle = ""
            }
            for (i = 0; i < styleArray.length; i++) {
                element.setAttribute("style", currentStyle + " " + styleArray[i] + ": " + styleArray[++i] + ";");
                currentStyle = element.getAttribute("style");
            };
        };

        // Adds style to all elements in an array
        function addStyleToArray(arrayOfElements, property, value) {
            for (let i = 0; i < arrayOfElements.length; i++) {
                addStyle(arrayOfElements[i], property, value);
            };
        };

        // Adds style to all elements of a class
        function addStyleByClass(cssClass, property, value) {
            let cssClassArray = document.getElementsByClassName(cssClass);

            addStyleToArray(cssClassArray, property, value);
        };

        function elmStyle(tag, parent, styleArray, id, cssClass) {
            var thisElm = elm(tag, parent, id, cssClass);
            addArrayOfStyles(thisElm, styleArray);
            return thisElm;
        };

        var body = document.body
    </script>
    <script>
        // An array of all the listings on the page
        var listings = document.getElementsByClassName("toyListing");
        // A locator for the container that holds the listings
        var listingsContainer = document.getElementById("listingsContainer");

        // this function adds a single listing to the page
        // the parameter snap is a snaphot of the database
        // the snap in this case actually only contains a snapshot of a SINGLE toy
        // this function is called by the filter function
        function createListing(snap) {

            // The key of the toy, used only as a back up if the name field is missing
            var thisToy = snap.key;
            // Grabbbing values from the snap
            var nameVal = snap.child("Name").val();
            var priceVal = snap.child("Price").val();
            var ageMaxVal = snap.child("Age_Max").val();
            var ageMinVal = snap.child("Age_Min").val();
            var picturePath = snap.child("Picture").val();
            var descriptionVal = snap.child("Description").val();

            // Create the html that will contain out listing and all it's information
            var thisListing = elm("div", listingsContainer, "", "toyListing ageOk priceOk searchOk");
            var title = elm("div", thisListing, "", "listingTitle");
            var price = elm("div", thisListing, "", "listingPrice");
            var ageRange = elm("div", thisListing, "", "listingAgeRange");
            var description = elm("div", thisListing, "", "listingAgeRange");

            // var thisListing = $('<div/>', {
            //     class: "toyListing ageOk priceOk searchOk"
            // });
            // thisListing.appendTo(listingsContainer);
            // var title = $('<div/>', {
            //     class: "listingAgeTitle"
            // }).appendTo(thisListing);
            // var price = $('<div/>', {
            //     class: "listingPrice"
            // }).appendTo(thisListing);
            // var ageRange = $('<div/>', {
            //     class: "listingAgeRange"
            // }).appendTo(thisListing);

            // create the picture for the listing
            var picture = $('<img/>', {
                class: 'listingPicture',
                alt: 'picture not available',
                //can get rid of .jpg if we add jpg to all files in database
                src: "Pictures/" + picturePath + '.jpg',
            }).appendTo(thisListing);

            // check that each value exists before adding it
            // if the value is null, display an error instead
            if (nameVal) {
                title.innerText = nameVal
            } else {
                title.innerText = "Error: " + thisToy
            }

            if (priceVal || priceVal == 0) {
                price.innerText = "Price: $" + priceVal
            } else {
                price.innerText = "Error: no pricing data"
            }

            if (!!ageMinVal.toString() && !!ageMaxVal.toString()) {
                ageRange.innerHTML = "Age Range: " + ageMinVal + "-" + ageMaxVal;
            } else {
                ageRange.innerHTML = "Age range not available";
            }

            if (descriptionVal) {
                description.innerHTML = descriptionVal;
            } else {
                description.innerHTML = "Try again";
            }

            console.log(picturePath);

            // var heart = $("<button/>", {
            //     class: "afav-btn"
            // }).html("").appendTo(title).css({
            //     display: "inline-block",
            //     height: "12pt",
            //     float: "right",
            // });

            var $favContainer = $("<div/>", {
                class: "afav-btn"
            }).html("").appendTo(title).css({
                display: "inline-block",
                height: '12pt',
                float: 'right',
            });

            var star = $("<button/>", {
                class: "fav-btn"
            }).html("").appendTo($favContainer).css({
                outline: 0
            });

        };

        function initializeListings() {
            // this is the reference to our datadase, specifically the toys
            dbRef = firebase.database().ref().child("Toys");
            // this runs once whenever initializeListings is called and grabs the data from the database
            dbRef.once('value', function (snapshot) {
                listingsContainer.innerHTML = "";
                // a loop for each toy
                snapshot.forEach(function (snap) {
                    createListing(snap);
                });
            });
        };
        initializeListings();
    </script>

    <script>
        // Favorite Button - Heart
        $('.favme').click(function () {
            $(this).toggleClass('active');
        });

        /* when a user clicks, toggle the 'is-animating' class */
        $(".favme").on('click touchstart', function () {
            $(this).toggleClass('is_animating');
        });

        /*when the animation is over, remove the class*/
        $(".favme").on('animationend', function () {
            $(this).toggleClass('is_animating');
        });
    </script>

    <script>
        // unused right now because it called the database too often
        // this is the function that filters the page
        function filterPlus(minPrice, maxPrice, minAge, maxAge) {
            // this is the reference to our database, specifically the toys
            dbRef = firebase.database().ref().child("Toys");
            // this function runs every time the database has a change
            dbRef.on('value', function (snapshot) {
                // IMPORTANT: clear the old listings before adding updated ones 
                listingsContainer.innerHTML = "";
                // a loop for each toy
                snapshot.forEach(function (snap) {
                    // grabbing values from the database
                    priceVal = snap.child("Price").val();
                    ageMaxVal = snap.child("Age_Max").val();
                    ageMinVal = snap.child("Age_Min").val();
                    // the actual filters, if any of these pass, it means the filter failed, return ends the loop
                    if (priceVal < minPrice || priceVal > maxPrice) {
                        return;
                    }
                    if (maxAge < ageMinVal || minAge > ageMaxVal) {
                        return;
                    }
                    // Calls the create listing function with a single toys data. We only get to this point if both filters pass
                    createListing(snap);
                });
            });
        };
    </script>

    <script>
        // create the sliders
        jQuery(function ($) {
            $('.priceSlider').asRange({
                range: true,
                value: [0, 100],
                format(value) {
                    return "$" + value;
                }
            });
        });

        jQuery(function ($) {
            $('.ageSlider').asRange({
                range: true,
                value: [0, 20],
                format(value) {
                    return value;
                }
            });
        });
    </script>

    <script>
        // this script tag contains filters
        // slider filters
        $('.priceSlider').on('asRange::change', function (e) {
            var price = $('.priceSlider').asRange('val');
            $(".toyListing").filter(function () {
                var listingsPrice = $(this.getElementsByClassName("listingPrice")[0]).text().split(
                    ': $')[1];
                if (listingsPrice >= price[0] && listingsPrice <= price[1]) {
                    $(this).addClass("priceOk").removeClass("priceNo");
                } else {
                    $(this).removeClass("priceOk").addClass("priceNo");
                };
            });
            $(".ageOk.searchOk.priceNo").hide();
            $(".ageOk.searchOk.priceOk").show();
        });

        $('.ageSlider').on('asRange::change', function (e) {
            var age = $('.ageSlider').asRange('val');
            $(".toyListing").filter(function () {
                var listingsAgeRange = $(this.getElementsByClassName("listingAgeRange")[0]).text()
                    .split(
                        ': ')[1];
                var listingsMinAge = listingsAgeRange.split('-')[0];
                var listingsMaxAge = listingsAgeRange.split('-')[1];
                if (listingsMinAge <= age[1] && listingsMaxAge >= age[0]) {
                    $(this).addClass("ageOk").removeClass("ageNo");
                } else {
                    $(this).removeClass("ageOk").addClass("ageNo");
                };
            });
            $(".priceOk.searchOk.ageNo").hide();
            $(".priceOk.searchOk.ageOk").show();
        });
        // search bar
        $(document).ready(function () {
            $(".searchBar").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $(".priceOk.ageOk").filter(function () {
                    // $(this).toggle($(this.getElementsByClassName("listingTitle")[0]).text().split(': ')[1].toLowerCase().indexOf(value) > -1);
                    var listingTitle = $(this.getElementsByClassName("listingTitle")[0]).text();
                    // .split(': ')[1];

                    if (listingTitle.toLowerCase().indexOf(value) > -1) {
                        $(this).addClass("searchOk").removeClass("searchNo");
                    } else {
                        $(this).removeClass("searchOk").addClass("searchNo");
                    };
                });
                $(".ageOk.priceOk.searchNo").hide();
                $(".ageOk.priceOk.searchOk").show();
            });
        });
    </script>

    <script>
        // For testing offline only
        // If the browser is offline, creates test listings to help with development
        // This code should be removed before production, but theoretically it would never be shown unless firebase is down and our website is not
        if (!navigator.onLine) {
            for (i = 0; i < 5; i++) {
                var thisListing = elm("div", listingsContainer, "", "toyListing");
                var title = elm("div", thisListing, "", "listingTitle");
                title.innerHTML = "You are offline";
                var price = elm("div", thisListing, "", "listingPrice");
                price.innerHTML = "Price: cannot connect";
                var ageRange = elm("div", thisListing, "", "listingAgeRange");
                ageRange.innerHTML = "Age Range: to-firebase";
            }
        }
    </script>

    <script>
        // make the filters move along with us as we scroll
        // avoids "position: fixed;"

        // When we scroll, call scroll function (below)
        $(() => {
            window.onscroll = () => {
                scrollFunction();
            };

            function scrollFunction() {
                // get chrome and edge to play along nicely with each other
                var scrollVal = Math.max($('html, body').scrollTop(), ($('body').scrollTop()));

                // transform the filters down by the scroll value.
                $('#filtersContainer').css({
                    transform: 'translate(0, ' + scrollVal + 'px)',
                })

                // console.log(scrollVal);

            };

        });
    </script>

    <script>
        // var textArray = [","","blah1","blah2"];
        // function changeText() {
        //     $("#message").delay(5500).animate({
        //         opacity: 0
        //     }, function () {
        //         $(this).html(
        //             "<b>90%</b> of all toys on the market are made of plastic, and barely any is being recycled." +
        //             "<br>" + "<br>" + "Donate Today.").animate({
        //             opacity: 1
        //         }, function () {
        //             $(this).delay(5500).animate({
        //                 opacity: 0
        //             }, function () {
        //                 $(this).html(
        //                     "In 2014, Americans generated about 33 million tons of plastic. The year before, only" +
        //                     "<b> 9.5 </b>" + "percent of plastics were recycled.").animate({
        //                     opacity: 1
        //                 }, function () {
        //                     $(this).delay(5500).animate({
        //                         opacity: 0
        //                     }, function () {
        //                         $(this).text(
        //                             "About 8 million tonnes of plastic enters the sea every year. We face a future with more plastic than fish by 2050."
        //                         ).animate({
        //                             opacity: 1
        //                         }, function () {
        //                             $(this).delay(5500).animate({
        //                                 opacity: 0
        //                             }, function () {
        //                                 $(this).text(
        //                                     "Small pieces of plastic are eaten by fish, turtles and seabirds. Animals and birds can also become tangled up in plastic debris, leading to death"
        //                                 ).animate({
        //                                     opacity: 1
        //                                 }, function () {
        //                                     changeText
        //                                         ();
        //                                 });
        //                             });
        //                         });
        //                     });
        //                 });
        //             });
        //         });
        //     });
        // };

        // changeText();

        // Define an array of all the text we want to cycle through
        // Used by changeText2, which cycles through text on the sidebar
        var infoArray = [
            "<b>90%</b> of all toys on the market are made of plastic, and barely any is being recycled.</p>" +
            "<p>Donate Today.",
            "In 2014, Americans generated about 33 million tons of plastic. The year before, only" +
            "<b> 9.5 </b>" + "percent of plastics were recycled.",
            "About 8 million tonnes of plastic enters the sea every year. We face a future with more plastic than fish by 2050.",
            "Small pieces of plastic are eaten by fish, turtles and seabirds. Animals and birds can also become tangled up in plastic debris, leading to death",
            "Global plastics consumption is predicted to grow dramatically.</p>" + "<p>Please reuse!"
        ];

        // Keeps track of where we are in the loop
        var changeTextI = 0;

        function changeText2() {
            // identify our target div and set a delay
            $("#message").delay(5500).animate({
                // Fade out
                opacity: 0
                // Then...
            }, function () {
                // display the next piece of text from the array in the div
                $(this).html(
                    "<p>" + infoArray[changeTextI] + "</p>").animate({
                    // Fade back in with the new text
                    opacity: 1
                }, function () {
                    // If we still have more text to loop through,
                    // add one to our variable and start again.
                    // Else restart at 0 then start again.
                    if (changeTextI < infoArray.length - 1) {
                        changeTextI++;
                    } else {
                        changeTextI = 0;
                    }
                    changeText2();
                });
            });
        }
        changeText2();
    </script>

    <script>
    function date_time(id) {
            date = new Date;
            year = date.getFullYear();
            month = date.getMonth();
            months = new Array('January', 'February', 'March', 'April', 'May', 'June', 'Jully', 'August', 'September', 'October', 'November', 'December');
            d = date.getDate();
            day = date.getDay();
            days = new Array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday');
            h = date.getHours();
                
            m = date.getMinutes();
            if (m < 10) {
                m = '0' + m;
            }
            s = date.getSeconds();
            if (s < 10) {
                s = '0' + s;
            }
        result = '' + days[day] + ', ' + months[month] + ' ' + d + ', ' + year + '<br>PST: ' + (h) + ':' + m + ':' + s;
        document.getElementById(id).innerHTML = result;
        setTimeout('date_time("' + id + '");', '1000');
        return true;
        }
        window.onload = date_time('date_time');
        
        </script>