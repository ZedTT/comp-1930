<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ToyShare: Canada's No.1 Toy Donation/Sell Center</title>

    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans" rel="stylesheet">
    <link rel="icon" href="toyShareLogopng.png">

    <link rel="stylesheet" href="css/asRange.css">
    <script src="JQuery.js"></script>
    <script src="jquery-asRange.js"></script>

    <script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBwSxJojnYNo9ZFKHmO59sKVPdEhCR641A",
            authDomain: "comp1930database.firebaseapp.com",
            databaseURL: "https://comp1930database.firebaseio.com",
            projectId: "comp1930database",
            storageBucket: "comp1930database.appspot.com",
            messagingSenderId: "908131063499"
        };
        firebase.initializeApp(config);
    </script>
    <link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="public/css/style.css">
    <style></style>
</head>

<body>
    <div id="header">
        <div id="left">
            <a href="databaseTest.html">
                <img src="toyShareLogopng.png" alt="toyShareLogo" id="toyShareLogo">
                <h1 id="toyShareLogoText">ToyShare</h1>
            </a>
        </div>
        <input class="searchBar" type="search" placeholder="Search for toys...." />
        <div id="right">
            <div class="messageButton"><img src="https://static.thenounproject.com/png/367821-200.png" alt="msgButton">
            </div>
            <div class="favouritesButton">Saved</div>
            <div class="profileButton">
                <img src="https://teambodyproject.com/wp-content/uploads/2019/01/profile-icon.png" alt="profileSetting"
                    id="profileSetting"></div>
            <button onclick="logout()" id="logOutButton">Logout</button>
        </div>
        <div class="barDiv">
            <div id="filtersContainer">
                <div id="filters">
                    <h3>Filters</h3>
                    <div class="filter">
                        <div class="filterTitle sliderTitle">Price:</div>
                        <input class="priceSlider slider" type="range" min="0" max="100" name="price" step="1" />
                    </div>
                    <div class="filter">
                        <div class="filterTitle sliderTitle">Age:</div>
                        <input class="ageSlider slider" type="range" min="0" max="20" name="age" step="1" />
                    </div>
                </div>
            </div>
        </div>
        <div class="counterDiv">
            <div id="toyCountMessage">Total Number Of Toys Saved:</div>
            <div id="toyCount"></div>
        </div>
    </div>

    <div id="banner">
        <div id="bannerDiv">
            <h1>Welcome to ToyShare</h1>
            <p>Canada's No.1 Toy Donation/Sell Center<br>With your support, together we can reduce plastic waste and
                help save the world.</p>
            <div id="signUpButton" onclick="location.href='signInPage.html'">Sign Up</div>
            <div id="signedUpButton"></div>
        </div>
    </div>
    <div id="content">

        <div id="listingsContainer" class="dropShadow"></div>
        <div id="ads" class="dropShadow">
            <div class="wasteInfo">
                <img src="http://thearenaweekly.myschoolarena.com/wp-content/uploads/2018/04/doctor.jpg"
                    alt="Kid Playing With Toy">
                <div id="message">
                    <p>Global plastics consumption is predicted to grow dramatically.</p>
                    <p>Please reuse!</p>
                </div>
            </div>
            <div class="learnMore">Learn more on how to donate at your local ToyShare.
                <div class="learnMoreButton" onclick="location.href='https://www.reddit.com/'" style="cursor:pointer;">
                    Learn More</div>
            </div>
            <div class="ecoCityAd1"><a href="http://ecocity2019.com/" target="blank"><img
                        src="http://ecocity2019.com/wp-content/uploads/2018/09/ecocity_web_logo.png"
                        alt="Dead Fish"></a>
            </div>
            <div class="redCrossAd"><a
                    href="https://donate.redcross.ca/page/22054/donate/1?ea.client.id=1951&ea.campaign.id=56787gclid=Cj0KCQjwnKHlBRDLARIsAMtMHDGxeGWl__vVJsAgp6k0Bqq27MXxe8p1ECBCKZRV3C-diJxqhCjTI28aAv44EALw_wcB"
                    target="blank"><img
                        src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/6f2ec7bd-e524-470f-a48b-0caad9aec3cb/dapk0t-82a0005f-fc5e-4f27-b32a-accf1b32c2af.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzZmMmVjN2JkLWU1MjQtNDcwZi1hNDhiLTBjYWFkOWFlYzNjYlwvZGFwazB0LTgyYTAwMDVmLWZjNWUtNGYyNy1iMzJhLWFjY2YxYjMyYzJhZi5qcGcifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6ZmlsZS5kb3dubG9hZCJdfQ.MNTB_gkoOLgdHzsmJL7pW6JwsJVfldgs7oDonbUiPOQ"
                        alt="Red Cross"></a>
            </div>
            <div class="bcitAd"><a href="https://commons.bcit.ca/news/2017/02/a-new-brand-platform-for-a-complex-world/"
                    target="blank"><img
                        src="https://commons.bcit.ca/news/files/2017/02/BCIT-Brand-Advertising-2-e1490219022604.jpg"
                        alt="BCIT"></a></div>
        </div>
    </div>
    <script>
        // Read
        var output = document.getElementById("toyCount");
        var dbRef = firebase.database().ref().child("Counter");
        dbRef.on("value", function (snap) {
            output.innerText = snap.val();
        });
    </script>
    <!-- WRITE -->
    <!-- button script -->
    <script>
        /** function myFunction() { 	
                var name = document.getElementById("toyCount").value;
                var dbref = firebase.database().ref("/");
                
                dbref.once("value", function(snap){
                    var {AddedCount} = snap.val();
                    var {Count} = snap.val();
                    Count += AddedCount;
                    console.log(Count);
                    dbref.update({
                    "Counter" : Count
                    });
                    window.location.href="./about.html";
                });
            } */
    </script>
    <script>
        var dbref = firebase.database().ref("/");
        var counterRef = dbref.child("Counter");
        var count;
        $('#listingsContainer').click(function () {
            counterRef.once("value", function (snap) {
                count = snap.val();
            }).then(dbref.update({
                "Counter": count + 1
            }));
            
        })
    </script>
    <script src="public/js/domlibrary.js"></script>
    <script src="public/js/initializeListings.js"></script>

    <script>
        // Favorite Button - Heart
        $('.favme').click(function () {
            $(this).toggleClass('active');
        });

        /* when a user clicks, toggle the 'is-animating' class */
        $(".favme").on('click touchstart', function () {
            $(this).toggleClass('is_animating');
        });

        /*when the animation is over, remove the class*/
        $(".favme").on('animationend', function () {
            $(this).toggleClass('is_animating');
        });
    </script>

    <script>
        // unused right now because it called the database too often
        // this is the function that filters the page
        function filterPlus(minPrice, maxPrice, minAge, maxAge) {
            // this is the reference to our database, specifically the toys
            dbRef = firebase.database().ref().child("Toys");
            // this function runs every time the database has a change
            dbRef.on('value', function (snapshot) {
                // IMPORTANT: clear the old listings before adding updated ones 
                listingsContainer.innerHTML = "";
                // a loop for each toy
                snapshot.forEach(function (snap) {
                    // grabbing values from the database
                    priceVal = snap.child("Price").val();
                    ageMaxVal = snap.child("Age_Max").val();
                    ageMinVal = snap.child("Age_Min").val();
                    // the actual filters, if any of these pass, it means the filter failed, return ends the loop
                    if (priceVal < minPrice || priceVal > maxPrice) {
                        return;
                    }
                    if (maxAge < ageMinVal || minAge > ageMaxVal) {
                        return;
                    }
                    // Calls the create listing function with a single toys data. We only get to this point if both filters pass
                    createListing(snap);
                });
            });
        };
    </script>

    <script src="public/js/sliderFilters.js"></script>

    <script src="public/js/offlinetest.js"></script>

    <script>
        /** 
        // Commented out for prototype header storing the filters
        // make the filters move along with us as we scroll
        // avoids "position: fixed;"

        // When we scroll, call scroll function (below)
        $(() => {
            window.onscroll = () => {
                scrollFunction();
            };

            function scrollFunction() {
                // get chrome and edge to play along nicely with each other
                var scrollVal = Math.max($('html, body').scrollTop(), ($('body').scrollTop()));

                // transform the filters down by the scroll value.
                $('#filtersContainer').css({
                    transform: 'translate(0, ' + scrollVal + 'px)',
                })

                // console.log(scrollVal);

            };

        });
        */
    </script>

    <script src="public/js/changetext.js"></script>
    <script>
        function logout() {
            firebase.auth().signOut();
            firebase.auth().onAuthStateChanged(user => {
                if (!user) {
                    window.location =
                    'signInPage.html'; //After successful logout, user will be redirected to signInPage.html
                }
            });
        }
    </script>

    <script>
        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                // User is signed in.

                document.getElementById("signedUpButton").style.display = "block";
                document.getElementById("signUpButton").style.display = "none";

                var user = firebase.auth().currentUser;

                if (user != null) {

                    var email_id = user.email;
                    document.getElementById("signedUpButton").innerHTML = "Welcome back " + email_id;

                }

            } else {
                // No user is signed in.

                document.getElementById("signedUpButton").style.display = "none";
                document.getElementById("signUpButton").style.display = "block";

            }
        });
    </script>